{% extends 'base.html' %}
{% block content %}

<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hola</title>
    <style>
        body {
            background-color: #4E4E4E; /* Change this to any color you want */
            margin: 0; /* Removes default margin */
            height: 100vh; /* Ensures full page coverage */
        }

        #game {
            justify-content: center;
            align-items: center;
            text-align: center;
            border: solid black 1px;
            height: auto;
            width: 100%;
        }

        #window {
            display: flex;
            flex-direction: row;
            /*border: solid black 5px;*/
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        #bg {
            background-image: url("/media/entitypfp/Unicorn.jpg");
            background-size: cover;
            background-position: center;  
            background-repeat: no-repeat;  
            height: 600px;
            /*width: 100%;*/
            width: 850px;
        }

        .Iblock {
            background-color: rgb(41, 240, 41);
            height: 50px;
            width: 50px;
            border: solid black 1px;
        }

        .NIblock {
            background-color: rgb(240, 41, 41);
            height: 50px;
            width: 50px;
            border: solid black 1px;
        }

        .Bearblock {
            background-color: rgb(77, 44, 7);
            height: 50px;
            width: 50px;
            border: solid black 1px;
        }

        #begin {
            width: 100%;
            height: 50px;
            font-size: 1.1rem;
            font-family:'Jeju';
            background-color: white;
            border-radius: 20px;
            box-shadow: 0px 5px #393939;
        }

        .numpad {
            background-color: rgb(109, 109, 109);
            height: 300px;
            width: 200px;
            border: solid black 1px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
        }
        .numpad-screen {
            background-color: rgb(96, 113, 82);
            height: 100px;
            width: 150px;
            border: solid black 1px;
            border-style: inset;
        }

        .numpad-btn {
            background-color: rgb(61, 61, 61);
            height: 40px;
            width: 50px;
            border: solid black 1px;
            border-style: outset;
        }

        #clear {
            background-color: rgb(61, 61, 61);
            height: 20px;
            width: 150px;
            border: solid black 1px;
            border-style: outset;
        }

        #restart { 

            width: 100%;
            height: 50px;
            font-size: 1.1rem;
            font-family:'Jeju';
            background-color: white;
            border-radius: 20px;
            box-shadow: 0px 5px #393939;
        }

        h1 {
            font-family: 'Jeju';
            color: white;
        }
        </style>

</head>
<body>

    <main>
        <div id="game">
            <h1 style="color:white;">Escape Room</h1>
            <h1 id="timer" style="color: white;">Time: 0s</h1>

            <button id="begin" onclick="gameStart()">Begin?</button>

            <div id="reload">          
                <a href="{% url 'escape' %}">
                    <button id="restart">Restart?</button>
                </a>
            </div> 


        <div id="window">

            <div id="bg">

                <div class = "Iblock" onclick="escapehere(this)"><p>Door</p></div>
                <div class = "NIblock"></div>
                <div class = "Iblock" onclick="collectedScissors(this)"><p>JAr</p></div>
                <div class = "Iblock" onclick="collectedPaper(this)"><p>Chest</p></div>
                <div class = "NIblock"></div>
                <div class = "Bearblock" onclick="bearly_qualified(this)"><p>Bear</p></div>
                <div class = "NIblock"></div>
                <div class = "Iblock" onclick="collectedSafe(this)"><p>Safe</p></div>
                <div class = "NIblock"></div>
                <div class = "Iblock" onclick="collectedComputer(this)"><p>Comp</p></div>
                

            </div>

            <div class="numpad">
                <div id = "screen">
                    <div class="numpad-screen">
                        <p id="CodeInput" style="color: white;">Code: </p>
                    </div>
                </div>
                <div id="pad">
                    <div class="numpad-btn" onclick="insert(1)">1</div>
                    <div class="numpad-btn" onclick="insert(2)">2</div>
                    <div class="numpad-btn" onclick="insert(3)">3</div>
                    <div class="numpad-btn" onclick="insert(4)">4</div>
                    <div class="numpad-btn" onclick="insert(5)">5</div>
                    <div class="numpad-btn" onclick="insert(6)">6</div>
                    <div class="numpad-btn" onclick="insert(7)">7</div>
                    <div class="numpad-btn" onclick="insert(8)">8</div>
                    <div class="numpad-btn" onclick="insert(9)">9</div>
                </div>
                <div id="clear" onclick="clearnum()">Clear</div>
            </div>


        </div>

        <h1 id="IND" style="color: white;">Collected Items: []</h1>
        <h1 id="xp" style="color: white;">Exp Gained: </h1>



        </div>


        <script>
            let inventory = [];
            let num = "";

            function collectedScissors(item){
                alert("The jar has...scissors. Questionable.");
                inventory.push("Scissors")
                item.onclick = null;
                updateInventory();
            }

            function collectedPaper(item){
                if (inventory.includes("Key")){
                    alert("It's a strange note.");
                    inventory.push("Note");
                    item.onclick = null;
                } else {
                    alert("The chest needs a key.")
                }
                updateInventory();
            }

            function collectedSafe(item){
                let answer = "1234";
                alert("There's a code...");
                    //code to input code somehow
                if (answer.toString() == num){
                    alert("It opened! You got a gun!");
                    inventory.push("Gun");
                    item.onclick = null;
                } else {
                    alert("That's not the right code.");
                    }

                updateInventory();
            }

            function collectedComputer(item){
                let answer = "1112";
                alert("It needs a password.");
                    //code to input code somehow
                if (answer == num){
                    alert("Master Hacker! There's a code here. Let's write it down.");
                    inventory.push("Door Code: [8898]");
                    item.onclick = null;
                } else {
                    alert("Wrong password.");
                    }
                updateInventory();
            }

            function escapehere(item){
                let answer = "8898";
                alert("The door needs a code.");
                    //code to input code somehow
                if (answer == num){
                    alert("It opened! Time to escape!");
                    if (inventory.includes("Gun")){
                        stopTimer();
                        alert("Somethings jumps out at you, but you shoot it dead. You escaped!")
                        expGain();
                        promptRestart();
                    } else{
                        stopTimer();
                        alert("Somethings jumps out at you! You're dead.")
                        promptRestart();
                    }
                    item.onclick = null;
                } else {
                    alert("Dang it. Didn't open.");
                    }
                updateInventory();
            }


            function bearly_qualified(item){
                if (inventory.includes("Scissors") && !inventory.includes("Key") ){
                    alert("You cut the bear open with scissors! There's a key!");
                    inventory.push("Key");
                } else if(inventory.includes("Key")) {
                    alert("You've gutted him...");
                } else {
                    alert("What a strange place for a toy...");
                }
                updateInventory();

            }

            function insert(x){
                if(num.length < 4) {
                num = num + x.toString();
                updateCode();
                console.log(num)
                }

            }

            function clearnum(){
                num ="";
                updateCode();
            }

            function updateInventory() {
                 document.getElementById("IND").textContent = "Inventory: [" + inventory.join(", ") + "]";
            }
            function updateCode() {
                 document.getElementById("CodeInput").textContent = "Code: " +num;
            }

            function showEXP() {
                 document.getElementById("xp").textContent = "Exp Gained: " +exp;
            }

            document.getElementById("bg").style.display = "none";
            document.getElementById("timer").style.display = "none";
            document.getElementById("reload").style.display = "none";
            document.getElementById("xp").style.display = "none";

            function gameStart() {
                document.getElementById("bg").style.display = "block";
                document.getElementById("timer").style.display = "block";
                document.getElementById("begin").style.display = "none";
                startTimer();
            }

            function promptRestart(){
                document.getElementById("reload").style.display = "block";
            }

            

            let seconds = 0;
            let timerInterval = null;

            function startTimer() {
                timerInterval = setInterval(() => {
                    seconds++;
                    document.getElementById("timer").textContent = "Time: " + seconds + "s";
                }, 1000); // 1000 milliseconds = 1 second
            }

            function stopTimer() {
                clearInterval(timerInterval);
                console.log("Timer stopped at " + seconds + " seconds");
            }

            let exp = 0;
            const csrfToken = '{{ csrf_token }}';

            function expGain() {
                if (seconds < 60 && seconds > 30) {
                    exp = 15;
                } else if (seconds < 30) {
                    exp = 20;
                } else {
                    exp = 10;
                }
                
                console.log(exp);
                console.log(seconds);
                document.getElementById("xp").style.display = "block";
                showEXP();

                fetch("/Escape/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": csrfToken
                    },
                    body: JSON.stringify({ exp: exp })
                })
                .then(res => res.json())
                .then(data => {
                    console.log("Success!", data);
                })
                .catch(err => {
                    console.error("Error:", err);
                });
            }


        </script>
    </main>

    <footer>
    </footer>

</body>
</html>
{% endblock %}